<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOGUE | 雲端預約系統</title>
    <style>
        :root { --gold: #d4af37; --bg: #0a0a0a; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: #111; border: 1px solid var(--gold); border-radius: 15px; padding: 20px; width: 90%; max-width: 400px; margin-bottom: 20px; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #333; box-sizing: border-box; font-size: 16px; }
        button { background: var(--gold); color: #000; font-weight: bold; cursor: pointer; border: none; margin-top: 15px; }
        .booking-item { background: #1a1a1a; padding: 15px; border-left: 5px solid var(--gold); margin-bottom: 10px; border-radius: 5px; text-align: left; }
    </style>
</head>
<body>

    <h1 style="color:var(--gold);">VOGUE 雲端預約</h1>

    <div class="card">
        <input type="text" id="custName" placeholder="顧客姓名">
        <select id="custService">
            <option value="單色染髮">單色染髮</option>
            <option value="雙色染髮">雙色染髮</option>
            <option value="漂染髮">漂染髮</option>
            <option value="染前頭皮保養套餐">染前頭皮保養套餐</option>
            <option value="剪髮">剪髮</option>
            <option value="洗髮加剪髮">洗髮加剪髮</option>
            <option value="熱塑燙髮">熱塑燙髮</option>
            <option value="冷塑燙髮">冷塑燙髮</option>
            <option value="頂級頭皮養護">頂級頭皮養護</option>
            <option value="頂級護髮套餐">頂級護髮套餐</option>
        </select>
        <input type="date" id="appDate">
        <input type="time" id="appTime">
        <button onclick="saveToCloud()">送出預約 (同步雲端)</button>
    </div>

    <div id="admin-panel" style="width: 90%; max-width: 400px;">
        <h3 style="color:var(--gold); border-bottom: 1px solid #333;">設計師後台 (即時清單)</h3>
        <div id="booking-list">載入中...</div>
    </div>

    <script type="module">
        // 正確引入 Firebase 功能
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // 使用您截圖中的專案設定
        const firebaseConfig = {
            apiKey: "AIzaSyD0TcQWJOP6Bm9qOt85fKXcx1boTq3RfNE",
            authDomain: "booking-af275.firebaseapp.com",
            databaseURL: "https://booking-af275-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "booking-af275",
            storageBucket: "booking-af275.firebasestorage.app",
            messagingSenderId: "252618990418",
            appId: "1:252618990418:web:6e7bd13e8af50a418ed08b"
        };

        // 初始化
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const bookingRef = ref(db, 'vogue_bookings'); // 修正：定義資料庫路徑

        // 客人送出功能
        window.saveToCloud = function() {
            const name = document.getElementById('custName').value;
            const service = document.getElementById('custService').value;
            const date = document.getElementById('appDate').value;
            const time = document.getElementById('appTime').value;

            if(!name || !date || !time) return alert("請填寫完整資訊");

            push(bookingRef, {
                name: name,
                service: service,
                time: date + " " + time,
                createdAt: Date.now()
            }).then(() => {
                alert("預約成功！資料已同步至雲端。");
                // 清空欄位
                document.getElementById('custName').value = "";
            }).catch((error) => {
                alert("儲存失敗，請檢查 Firebase 規則是否已發佈為 true");
                console.error(error);
            });
        };

        // 設計師讀取功能
        onValue(bookingRef, (snapshot) => {
            const listDiv = document.getElementById('booking-list');
            listDiv.innerHTML = "";
            const data = snapshot.val();
            
            if (!data) {
                listDiv.innerHTML = "目前尚無預約紀錄。";
                return;
            }

            // 排序：最新的在上面
            const sortedItems = Object.values(data).sort((a, b) => b.createdAt - a.createdAt);

            sortedItems.forEach(item => {
                listDiv.innerHTML += `
                    <div class="booking-item">
                        <strong>${item.name}</strong> - ${item.service}<br>
                        <small style="color:#888;">預約時間：${item.time}</small>
                    </div>
                `;
            });
        });
    </script>
</body>
</html>
